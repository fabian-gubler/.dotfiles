#!/bin/sh -eu
# vim:et:ts=4
#
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Description:
#     A dmenu script to interact with mpris.
#
#     ðŸ‘‘ Long live the queen ðŸ‘‘
#  
# Dependencies:
#     - gnu-core-utils
#     - dmenu
#     - xclip (optional)
#     - feh (optional)
#     - playerctl
#     - (daemon) playerctld needs to be running to keep track of focus
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#

status=$(
    playerctl metadata --format \
"{{status}} ({{playerName}})
    TITLE:     {{title}}
   ARTIST:     {{artist}}
    ALBUM:     {{album}}
     YEAR:     {{xesam:contentCreated}}
    TRACK:     {{xesam:trackNumber}}
 POSITION:     {{duration(position)}}/{{duration(mpris:length)}}
   VOLUME:     {{volume}}
   ARTURL:     {{mpris:artUrl}}
   LYRICS:     {{xesam:asText}}" \
|| printf 'No players found')

sel=$(printf \
'; [ play-pause ]
: [  pause all ]
> [    next    ]
< [    prev    ]
\ [    stop    ]
/ [   volume   ]
* [  open uri  ]
. [ focus next ]
, [ focus prev ]
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
%s' "$status" | dmenu -i -l -1 -p 'ðŸ‘‘ MPRIS menu ðŸ‘‘')

install_dir=$HOME/.dotfiles/scripts/dmenu/

case "$sel" in
    ';'*) playerctl play-pause ;;
    ':'*) playerctl -a pause ;;
    '>'*) playerctl next ;;
    '<'*) playerctl previous ;;
    '\'*) playerctl stop ;;

    # Volume
    '/'*)
        volume=$(printf '' | dmenu -i -l 0 -p 'ðŸ”Š enter target volume (0.0 - 1.0) ðŸ”Š')
        playerctl volume "$volume"
        ;;

    # Open uri
    '*'*)
        uri=$(printf '' | dmenu -i -l 0 -p 'ðŸ”— Enter URI to open ðŸ”—')
        playerctl open "$uri"
        ;;

    # Shift focus
    '.'*) 
        playerctld shift 
        $install_dir/mpris
        ;;
    ','*) 
        playerctld unshift 
        $install_dir/mpris
        ;;

    # In case someone asks you the name of a song :D
    *)
        echo "$sel" | xclip -selection clipboard ;;
esac
